<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login / Register - Disability Support Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif}
    body{
      /* Doraemon Background Color: Sky Blue */
      background: #87CEEB; 
      display:flex;align-items:center;justify-content:center;flex-direction:column;height:100vh;
      overflow: hidden; 
    }
    
    /* === Floating Circles Background Animation === */
    .context {
        width: 100%;
        height:100%;
        position: absolute;
        top:0;
        left:0;
        z-index: 1;
    }

    .circles{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .circles li{
        position: absolute;
        display: block;
        list-style: none;
        width: 20px;
        height: 20px;
        /* Sky Blue with opacity */
        background: rgba(135, 206, 235, 0.4); 
        animation: animateBubbles 25s linear infinite;
        bottom: -150px;
        cursor: pointer; 
        transition: background 0.3s, transform 0.3s;
    }

    /* Interaction: Bubble grows when mouse hovers over it */
    .circles li:hover {
        transform: scale(3.5); /* Makes it 3.5 times bigger */
        background: rgba(255, 255, 255, 0.8); /* Changes to White/lighter color (Doraemon's face) */
    }

    .circles li:nth-child(2){
        left: 10%;
        width: 40px;
        height: 40px;
        animation-delay: 2s;
        animation-duration: 12s;
        /* Deeper Blue for contrast */
        background: rgba(0, 114, 206, 0.5); 
    }

    .circles li:nth-child(3){
        left: 70%;
        width: 50px;
        height: 50px;
        animation-delay: 4s;
        background: rgba(135, 206, 235, 0.6);
    }

    .circles li:nth-child(4){
        left: 40%;
        width: 35px;
        height: 35px;
        animation-duration: 18s;
    }

    .circles li:nth-child(5){
        left: 65%;
        width: 60px;
        height: 60px;
        animation-delay: 1s;
        /* Red color for Doraemon's collar/bell contrast */
        background: rgba(255, 0, 0, 0.4); 
    }

    .circles li:nth-child(6){
        left: 30%;
        width: 20px;
        height: 20px;
        animation-delay: 3s;
        animation-duration: 8s;
    }

    .circles li:nth-child(7){
        left: 80%;
        width: 75px;
        height: 75px;
        animation-delay: 7s;
        background: rgba(0, 114, 206, 0.5);
    }
    
    @keyframes animateBubbles {
        0%{
            transform: translateY(0) rotate(0deg);
            opacity: 1;
            border-radius: 50%;
        }
        100%{
            transform: translateY(-1000px) rotate(720deg);
            opacity: 0;
            border-radius: 50%;
        }
    }
    /* === END Floating Circles Background Animation === */

    .container{
      background:#fff;border-radius:30px;
      box-shadow:0 5px 15px rgba(0,0,0,0.35);
      position:relative;
      overflow:hidden;
      width:768px;max-width:100%;min-height:520px;
      z-index: 10; 
    }
    
    .form-container.sign-in,
    .form-container.sign-up {
        padding-top: 0; 
    }

    .container button{
      background:linear-gradient(90deg, #ff7e5f, #feb47b);
      color:#fff;font-size:12px;
      padding:10px 45px;border:none;border-radius:8px;
      font-weight:600;text-transform:uppercase;margin-top:10px;cursor:pointer;
      transition: transform 0.3s ease;
    }
    .container button:hover {
        transform: scale(1.05);
    }
    .container form{
      background:#fff;display:flex;align-items:center;justify-content:center;
      flex-direction:column;padding:0 40px;height:100%;
    }
    .container input{
      background:#eee;border:none;margin:8px 0;padding:10px 15px;
      font-size:13px;border-radius:8px;width:100%;outline:none;
    }
    #signInOTP{letter-spacing:2px;
      font-weight:500;
      text-decoration: none;
    }
    .form-container{position:absolute;top:0;height:100%;transition:all 0.6s ease-in-out;}
    .sign-in{left:0;width:50%;z-index:2;}
    .container.active .sign-in{transform:translateX(100%);z-index:1;opacity:0;animation:move 0.6s;}
    .sign-up{left:0;width:50%;opacity:0;z-index:1;}
    .container.active .sign-up{transform:translateX(100%);opacity:1;z-index:5;animation:move 0.6s;}
    @keyframes move{0%,49.99%{opacity:0;z-index:1;}50%,100%{opacity:1;z-index:5;}}
    .toggle-container{position:absolute;top:0;left:50%;width:50%;height:100%;
      overflow:hidden;transition:all 0.6s ease-in-out;border-radius:150px 0 0 100px;z-index:1000;}
    .container.active .toggle-container{transform:translateX(-100%);border-radius:0 150px 100px 0;}
    .toggle{
      background:linear-gradient(to right, #2575fc, #6a11cb);
      color:#fff;position:relative;left:-100%;height:100%;width:200%;
      transform:translateX(0);transition:all 0.6s ease-in-out;}
    .container.active .toggle{transform:translateX(50%);}
    .toggle-panel{position:absolute;width:50%;height:100%;display:flex;align-items:center;
      justify-content:center;flex-direction:column;padding:0 30px;text-align:center;
      top:0;transition:all 0.6s ease-in-out;}
    .toggle-left{transform:translateX(-200%);}
    .container.active .toggle-left{transform:translateX(0);}
    .toggle-right{right:0;transform:translateX(0);}
    .container.active .toggle-right{transform:translateX(200%);}
    p{font-size:18px;font-weight:500;color:#333;margin:15px 0 0;}
    h1{font-weight:400;font-size:40px;line-height:1.2;margin:0; color: #2575fc;}
    .msg{display:none;margin-top:10px;padding:8px 12px;border-radius:6px;font-size:13px;}
    #resendLink {color: #2575fc !important;} 
  </style>
</head>
<body>
    <div class="context">
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>
  <div class="container" id="container">
    
    <div class="form-container sign-up">
      <form id="signUpForm">
        <h1>Create Account</h1>
        <input type="text" id="signUpName" placeholder="Name" required />
        <input type="tel" id="signUpPhone" placeholder="Mobile Number" required />
        <input type="password" id="signUpPassword" placeholder="Password" required />
        <button type="submit">Get in</button>
        <div id="signUpMessage" class="msg"></div>
      </form>
    </div>

    <div class="form-container sign-in">
      <form id="signInForm">
        <h1>Sign In</h1>
        <input type="tel" id="signInPhone" placeholder="Enter Mobile No" required/>
        <input type="password" id="signInPassword" placeholder="Enter Password" required/> <a style="text-decoration: none;font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;" href="#" id="resendLink">Send OTP</a>
        <button type="submit">Sign In</button>
        <div id="signInMessage" class="msg"></div>
      </form>
    </div>

    <div class="toggle-container">
      <div class="toggle">
        <div class="toggle-panel toggle-left">
          <h1 style="color: white;">Welcome Back!</h1>
          <p style="color: white;">Enter your details to use all features</p>
          <button class="hidden" id="login">sign-in</button>
        </div>
        <div class="toggle-panel toggle-right">
          <h1 style="color: white;">Welcome!</h1>
          <p style="color: white;">New here? Register now</p>
          <button class="hidden" id="register">Register</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const container = document.getElementById("container");
    const registerBtn = document.getElementById("register");
    const loginBtn = document.getElementById("login");
    const resendLink = document.getElementById("resendLink");

    registerBtn.addEventListener("click", () => container.classList.add("active"));
    loginBtn.addEventListener("click", () => container.classList.remove("active"));

    // Base URL for the backend
    const API_BASE_URL = 'http://localhost:3000/api';

    // Utility message function
    function showMessage(elemId, text, color="#f3f3f3") {
      const el = document.getElementById(elemId);
      if (!el) return;
      el.style.display = "block";
      el.textContent = text;
      el.style.background = color;
      clearTimeout(el._hideTimer);
      el._hideTimer = setTimeout(() => { el.style.display = "none"; }, 5000); // 5 seconds display
    }

    // --- Sign Up: Handle Registration with Backend ---
    document.getElementById("signUpForm").addEventListener("submit", async function(e){
        e.preventDefault();
        const name = document.getElementById("signUpName").value.trim();
        const phone = document.getElementById("signUpPhone").value.trim();
        const password = document.getElementById("signUpPassword").value.trim();

        try {
            const response = await fetch(`${API_BASE_URL}/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, phone, password })
            });

            const data = await response.json();

            if (response.ok) {
                showMessage("signUpMessage", '✅ Registration successful for ${name}! Please sign in.', "#d4edda");
                // Switch to login view after successful registration
                setTimeout(() => { container.classList.remove("active"); }, 1500); 
           } else {
                showMessage("signInMessage", `❌ Error: ${data.message || 'Invalid phone or password.'}`, "#ffe6e6");
            }
        } catch (error) {
            console.error('Network Error:', error);
            showMessage("signUpMessage", "❌ Network error. Check server connection.", "#ffe6e6");
        }
    });

    // --- Sign In: Handle Login with Backend ---
    document.getElementById("signInForm").addEventListener("submit", async function(e){
        e.preventDefault();
        const phone = document.getElementById("signInPhone").value.trim();
        const password = document.getElementById("signInPassword").value.trim(); // Now using password input

        try {
            const response = await fetch(`${API_BASE_URL}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone, password })
            });
            
            const data = await response.json();

            if (response.ok) {
                // *** CRITICAL STEP: Store the JWT Token ***
                localStorage.setItem('userToken', data.token); 
                
                showMessage("signInMessage", '✅ Login successful! Redirecting to Home...,', "#d4edda");
                setTimeout(()=>{ window.location.href="index.html"; },900);
           } else {
                showMessage("signInMessage", `❌ Error: ${data.message || 'Invalid phone or password.'}`, "#ffe6e6");
            }
        } catch (error) {
            console.error('Network Error:', error);
            showMessage("signInMessage", "❌ Network error.", "#ffe6e6");
        }
    });

    // --- Send OTP Link (Updated for clarity - real service required on backend) ---
    resendLink.addEventListener("click", function(e){
      e.preventDefault();
      const phoneField = document.getElementById("signInPhone").value.trim();
      if (!phoneField){ showMessage("signInMessage","Enter a phone number to send OTP","#ffe6e6"); return; }
      
      // In a real application, you would call an endpoint like:
      // fetch(${API_BASE_URL}/auth/send-otp, { method: 'POST', body: JSON.stringify({ phone: phoneField }) });
      
      showMessage("signInMessage",'[DEMO] OTP request sent to ${phoneField}. Use your registered password to sign in.', "#e6ffe6");
    });
  </script>
</body>
</html>